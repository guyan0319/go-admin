{"remainingRequest":"D:\\gopath\\src\\go_admin\\vue-element-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\gopath\\src\\go_admin\\vue-element-admin\\src\\components\\Dropzone\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\gopath\\src\\go_admin\\vue-element-admin\\src\\components\\Dropzone\\index.vue","mtime":1571128427600},{"path":"D:\\gopath\\src\\go_admin\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\gopath\\src\\go_admin\\vue-element-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\gopath\\src\\go_admin\\vue-element-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\gopath\\src\\go_admin\\vue-element-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n\r\nimport Dropzone from 'dropzone'\r\nimport 'dropzone/dist/dropzone.css'\r\n// import { getToken } from 'api/qiniu';\r\n\r\nDropzone.autoDiscover = false\r\n\r\nexport default {\r\n  props: {\r\n    id: {\r\n      type: String,\r\n      required: true\r\n    },\r\n    url: {\r\n      type: String,\r\n      required: true\r\n    },\r\n    clickable: {\r\n      type: Boolean,\r\n      default: true\r\n    },\r\n    defaultMsg: {\r\n      type: String,\r\n      default: '上传图片'\r\n    },\r\n    acceptedFiles: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    thumbnailHeight: {\r\n      type: Number,\r\n      default: 200\r\n    },\r\n    thumbnailWidth: {\r\n      type: Number,\r\n      default: 200\r\n    },\r\n    showRemoveLink: {\r\n      type: Boolean,\r\n      default: true\r\n    },\r\n    maxFilesize: {\r\n      type: Number,\r\n      default: 2\r\n    },\r\n    maxFiles: {\r\n      type: Number,\r\n      default: 3\r\n    },\r\n    autoProcessQueue: {\r\n      type: Boolean,\r\n      default: true\r\n    },\r\n    useCustomDropzoneOptions: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    defaultImg: {\r\n      default: '',\r\n      type: [String, Array]\r\n    },\r\n    couldPaste: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      dropzone: '',\r\n      initOnce: true\r\n    }\r\n  },\r\n  watch: {\r\n    defaultImg(val) {\r\n      if (val.length === 0) {\r\n        this.initOnce = false\r\n        return\r\n      }\r\n      if (!this.initOnce) return\r\n      this.initImages(val)\r\n      this.initOnce = false\r\n    }\r\n  },\r\n  mounted() {\r\n    const element = document.getElementById(this.id)\r\n    const vm = this\r\n    this.dropzone = new Dropzone(element, {\r\n      clickable: this.clickable,\r\n      thumbnailWidth: this.thumbnailWidth,\r\n      thumbnailHeight: this.thumbnailHeight,\r\n      maxFiles: this.maxFiles,\r\n      maxFilesize: this.maxFilesize,\r\n      dictRemoveFile: 'Remove',\r\n      addRemoveLinks: this.showRemoveLink,\r\n      acceptedFiles: this.acceptedFiles,\r\n      autoProcessQueue: this.autoProcessQueue,\r\n      dictDefaultMessage: '<i style=\"margin-top: 3em;display: inline-block\" class=\"material-icons\">' + this.defaultMsg + '</i><br>Drop files here to upload',\r\n      dictMaxFilesExceeded: '只能一个图',\r\n      previewTemplate: '<div class=\"dz-preview dz-file-preview\">  <div class=\"dz-image\" style=\"width:' + this.thumbnailWidth + 'px;height:' + this.thumbnailHeight + 'px\" ><img style=\"width:' + this.thumbnailWidth + 'px;height:' + this.thumbnailHeight + 'px\" data-dz-thumbnail /></div>  <div class=\"dz-details\"><div class=\"dz-size\"><span data-dz-size></span></div> <div class=\"dz-progress\"><span class=\"dz-upload\" data-dz-uploadprogress></span></div>  <div class=\"dz-error-message\"><span data-dz-errormessage></span></div>  <div class=\"dz-success-mark\"> <i class=\"material-icons\">done</i> </div>  <div class=\"dz-error-mark\"><i class=\"material-icons\">error</i></div></div>',\r\n      init() {\r\n        const val = vm.defaultImg\r\n        if (!val) return\r\n        if (Array.isArray(val)) {\r\n          if (val.length === 0) return\r\n          val.map((v, i) => {\r\n            const mockFile = { name: 'name' + i, size: 12345, url: v }\r\n            this.options.addedfile.call(this, mockFile)\r\n            this.options.thumbnail.call(this, mockFile, v)\r\n            mockFile.previewElement.classList.add('dz-success')\r\n            mockFile.previewElement.classList.add('dz-complete')\r\n            vm.initOnce = false\r\n            return true\r\n          })\r\n        } else {\r\n          const mockFile = { name: 'name', size: 12345, url: val }\r\n          this.options.addedfile.call(this, mockFile)\r\n          this.options.thumbnail.call(this, mockFile, val)\r\n          mockFile.previewElement.classList.add('dz-success')\r\n          mockFile.previewElement.classList.add('dz-complete')\r\n          vm.initOnce = false\r\n        }\r\n      },\r\n      accept: (file, done) => {\r\n        /* 七牛*/\r\n        // const token = this.$store.getters.token;\r\n        // getToken(token).then(response => {\r\n        //   file.token = response.data.qiniu_token;\r\n        //   file.key = response.data.qiniu_key;\r\n        //   file.url = response.data.qiniu_url;\r\n        //   done();\r\n        // })\r\n        done()\r\n      },\r\n      sending: (file, xhr, formData) => {\r\n        // formData.append('token', file.token);\r\n        // formData.append('key', file.key);\r\n        vm.initOnce = false\r\n      }\r\n    })\r\n\r\n    if (this.couldPaste) {\r\n      document.addEventListener('paste', this.pasteImg)\r\n    }\r\n\r\n    this.dropzone.on('success', file => {\r\n      vm.$emit('dropzone-success', file, vm.dropzone.element)\r\n    })\r\n    this.dropzone.on('addedfile', file => {\r\n      vm.$emit('dropzone-fileAdded', file)\r\n    })\r\n    this.dropzone.on('removedfile', file => {\r\n      vm.$emit('dropzone-removedFile', file)\r\n    })\r\n    this.dropzone.on('error', (file, error, xhr) => {\r\n      vm.$emit('dropzone-error', file, error, xhr)\r\n    })\r\n    this.dropzone.on('successmultiple', (file, error, xhr) => {\r\n      vm.$emit('dropzone-successmultiple', file, error, xhr)\r\n    })\r\n  },\r\n  destroyed() {\r\n    document.removeEventListener('paste', this.pasteImg)\r\n    this.dropzone.destroy()\r\n  },\r\n  methods: {\r\n    removeAllFiles() {\r\n      this.dropzone.removeAllFiles(true)\r\n    },\r\n    processQueue() {\r\n      this.dropzone.processQueue()\r\n    },\r\n    pasteImg(event) {\r\n      const items = (event.clipboardData || event.originalEvent.clipboardData).items\r\n      if (items[0].kind === 'file') {\r\n        this.dropzone.addFile(items[0].getAsFile())\r\n      }\r\n    },\r\n    initImages(val) {\r\n      if (!val) return\r\n      if (Array.isArray(val)) {\r\n        val.map((v, i) => {\r\n          const mockFile = { name: 'name' + i, size: 12345, url: v }\r\n          this.dropzone.options.addedfile.call(this.dropzone, mockFile)\r\n          this.dropzone.options.thumbnail.call(this.dropzone, mockFile, v)\r\n          mockFile.previewElement.classList.add('dz-success')\r\n          mockFile.previewElement.classList.add('dz-complete')\r\n          return true\r\n        })\r\n      } else {\r\n        const mockFile = { name: 'name', size: 12345, url: val }\r\n        this.dropzone.options.addedfile.call(this.dropzone, mockFile)\r\n        this.dropzone.options.thumbnail.call(this.dropzone, mockFile, val)\r\n        mockFile.previewElement.classList.add('dz-success')\r\n        mockFile.previewElement.classList.add('dz-complete')\r\n      }\r\n    }\r\n\r\n  }\r\n}\r\n",null]}